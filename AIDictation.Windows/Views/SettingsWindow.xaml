<Window x:Class="AIDictation.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings"
        Width="700" Height="550"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinWidth="600" MinHeight="450"
        Background="{StaticResource BackgroundBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}">
            <StackPanel Margin="8,16">
                <RadioButton x:Name="GeneralTab"
                             Content="âš™ï¸ General"
                             IsChecked="True"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="AccountTab"
                             Content="ðŸ‘¤ Account"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="PermissionsTab"
                             Content="ðŸ”’ Permissions"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="AudioTab"
                             Content="ðŸ”Š Audio"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="LanguageTab"
                             Content="ðŸŒ Language"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="DictionaryTab"
                             Content="ðŸ“– Dictionary"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="RulesTab"
                             Content="ðŸ“ Context Rules"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="ShortcutsTab"
                             Content="âŒ¨ï¸ Shortcuts"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
            </StackPanel>
        </Border>

        <!-- Content Area -->
        <ScrollViewer Grid.Column="1" Padding="24">
            <Grid>
                <!-- General Settings -->
                <StackPanel x:Name="GeneralPanel">
                    <TextBlock Text="General" Style="{StaticResource HeadlineText}"/>

                    <!-- Recording Hotkey -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Recording Hotkey" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Press this key combination to toggle recording from anywhere"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Border Grid.Column="1"
                                    Background="{StaticResource SurfaceBrush}"
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1"
                                    Padding="16,8"
                                    MinWidth="150"
                                    Cursor="Hand"
                                    MouseLeftButtonDown="HotkeyBox_Click">
                                <TextBlock x:Name="CurrentHotkeyDisplay"
                                           Text="Click to set..."
                                           HorizontalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Show Overlay When Idle -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Show Overlay When Idle" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="When disabled, overlay only appears during recording or processing"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="ShowOverlayWhenIdleCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="ShowOverlayWhenIdle_Changed" Unchecked="ShowOverlayWhenIdle_Changed"/>
                        </Grid>
                    </Border>

                    <!-- Overlay Position -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Overlay Position" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Choose where the overlay indicator appears on your screen"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <ComboBox x:Name="OverlayPositionCombo"
                                      Grid.Column="1"
                                      Width="150"
                                      SelectionChanged="OverlayPosition_SelectionChanged"/>
                        </Grid>
                    </Border>

                    <!-- Launch at Startup -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Launch at Login" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically start AIDictation when you log in"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="LaunchAtStartupCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="LaunchAtStartup_Changed" Unchecked="LaunchAtStartup_Changed"/>
                        </Grid>
                    </Border>

                    <!-- Include Screen Context -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Include Screen Context" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Capture and send screen content (via OCR) to improve transcription accuracy"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="IncludeScreenContextCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="IncludeScreenContext_Changed" Unchecked="IncludeScreenContext_Changed"/>
                        </Grid>
                    </Border>

                    <!-- Auto Paste -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Auto Paste After Transcription" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically paste transcribed text into the active window"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="AutoPasteCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="AutoPaste_Changed" Unchecked="AutoPaste_Changed"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Account Settings -->
                <StackPanel x:Name="AccountPanel" Visibility="Collapsed">
                    <TextBlock Text="Account" Style="{StaticResource HeadlineText}"/>

                    <!-- Account Status -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <StackPanel>
                            <!-- Email / Account Row -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Account" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="AccountStatusText"
                                               Text="Sign in to track usage and unlock Pro features"
                                               Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                </StackPanel>
                                <Button x:Name="SignInButton" Content="Sign In"
                                        Style="{StaticResource SecondaryButton}"
                                        Grid.Column="1"
                                        Click="SignIn_Click"/>
                                <Button x:Name="SignOutButton" Content="Sign Out"
                                        Style="{StaticResource SecondaryButton}"
                                        Grid.Column="1"
                                        Visibility="Collapsed"
                                        Click="SignOut_Click"/>
                            </Grid>

                            <!-- Subscription Status Row (shown when signed in) -->
                            <Border x:Name="SubscriptionRow" Visibility="Collapsed" Padding="0,12,0,0">
                                <StackPanel>
                                    <Rectangle Height="1" Fill="{StaticResource BorderBrush}" Margin="0,0,0,12"/>
                                    <StackPanel>
                                        <TextBlock Text="Subscription" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="SubscriptionText"
                                                   Text="Free"
                                                   Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- Word Usage Row (shown when signed in and Free tier) -->
                            <Border x:Name="WordUsageRow" Visibility="Collapsed" Padding="0,12,0,0">
                                <StackPanel>
                                    <Rectangle Height="1" Fill="{StaticResource BorderBrush}" Margin="0,0,0,12"/>
                                    <StackPanel>
                                        <TextBlock Text="Word Usage" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="WordUsageText"
                                                   Text="0 of 2,000 words this month"
                                                   Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Upgrade to Pro -->
                    <Border x:Name="UpgradeCard" Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Upgrade to Pro" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Unlimited transcriptions, priority support"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Button Content="Upgrade"
                                    Style="{StaticResource PrimaryButton}"
                                    Grid.Column="1"
                                    Click="Upgrade_Click"/>
                        </Grid>
                    </Border>

                    <!-- Reset Application -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Reset Application" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Clear all data and restart onboarding"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Button Content="Reset"
                                    Style="{StaticResource SecondaryButton}"
                                    Grid.Column="1"
                                    Click="ResetApp_Click"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Permissions Settings -->
                <StackPanel x:Name="PermissionsPanel" Visibility="Collapsed">
                    <TextBlock Text="Permissions" Style="{StaticResource HeadlineText}"/>

                    <!-- Microphone -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ðŸŽ™ï¸" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Microphone" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Required to record audio for transcription"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock x:Name="MicPermissionStatus" Text="âœ“" Foreground="{StaticResource SuccessBrush}"
                                           FontSize="18" VerticalAlignment="Center" Visibility="Collapsed"/>
                                <Button x:Name="MicPermissionButton" Content="Grant Access"
                                        Style="{StaticResource SecondaryButton}"
                                        Click="OpenMicrophoneSettings_Click"
                                        Visibility="Collapsed"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Auto-paste (Windows handles this automatically) -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="âœ‹" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Auto-paste" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Works automatically on Windows"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <TextBlock Text="âœ“" Foreground="{StaticResource SuccessBrush}"
                                       FontSize="18" VerticalAlignment="Center" Grid.Column="2"/>
                        </Grid>
                    </Border>

                    <!-- Screen Recording -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ðŸ–¥ï¸" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Screen Recording" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Required for screen context feature (OCR of active window)"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Button Content="Open Settings"
                                    Style="{StaticResource SecondaryButton}"
                                    Click="OpenScreenCaptureSettings_Click"/>
                        </Grid>
                    </Border>

                    <TextBlock Text="Note: Windows handles permissions differently than macOS. Most permissions are managed automatically through Windows Privacy Settings."
                               Style="{StaticResource CaptionText}"
                               TextWrapping="Wrap"
                               Margin="0,16,0,0"
                               Foreground="{StaticResource MutedForegroundBrush}"/>
                </StackPanel>

                <!-- Audio Settings -->
                <StackPanel x:Name="AudioPanel" Visibility="Collapsed">
                    <TextBlock Text="Audio" Style="{StaticResource HeadlineText}"/>

                    <!-- Input Device -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Input Device" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Select your microphone or audio input device"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <ComboBox x:Name="AudioDeviceCombo"
                                      Grid.Column="1"
                                      Width="250"
                                      SelectionChanged="AudioDevice_SelectionChanged"/>
                        </Grid>
                    </Border>

                    <!-- Mute Other Audio -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Mute Other Audio When Recording" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically lower system volume while recording"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="MuteAudioCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="MuteAudio_Changed" Unchecked="MuteAudio_Changed"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Language Settings -->
                <StackPanel x:Name="LanguagePanel" Visibility="Collapsed">
                    <TextBlock Text="Transcription Language" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Select languages for transcription. Auto-detect works for all languages."
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <WrapPanel>
                        <ToggleButton x:Name="LangAuto" Content="ðŸŒ Auto-detect" Style="{StaticResource LanguageToggleButton}" Tag="auto" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangEn" Content="ðŸ‡¬ðŸ‡§ English" Style="{StaticResource LanguageToggleButton}" Tag="en" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangRu" Content="ðŸ‡·ðŸ‡º Russian" Style="{StaticResource LanguageToggleButton}" Tag="ru" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangDe" Content="ðŸ‡©ðŸ‡ª German" Style="{StaticResource LanguageToggleButton}" Tag="de" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangFr" Content="ðŸ‡«ðŸ‡· French" Style="{StaticResource LanguageToggleButton}" Tag="fr" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangEs" Content="ðŸ‡ªðŸ‡¸ Spanish" Style="{StaticResource LanguageToggleButton}" Tag="es" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangIt" Content="ðŸ‡®ðŸ‡¹ Italian" Style="{StaticResource LanguageToggleButton}" Tag="it" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangPt" Content="ðŸ‡µðŸ‡¹ Portuguese" Style="{StaticResource LanguageToggleButton}" Tag="pt" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangZh" Content="ðŸ‡¨ðŸ‡³ Chinese" Style="{StaticResource LanguageToggleButton}" Tag="zh" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangJa" Content="ðŸ‡¯ðŸ‡µ Japanese" Style="{StaticResource LanguageToggleButton}" Tag="ja" Click="LanguageToggle_Click"/>
                        <ToggleButton x:Name="LangKo" Content="ðŸ‡°ðŸ‡· Korean" Style="{StaticResource LanguageToggleButton}" Tag="ko" Click="LanguageToggle_Click"/>
                    </WrapPanel>
                </StackPanel>

                <!-- Dictionary Settings -->
                <StackPanel x:Name="DictionaryPanel" Visibility="Collapsed">
                    <TextBlock Text="Dictionary" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Dictionary entries help recognize and format specific words correctly (e.g., 'gonna' â†’ 'going to')"
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="DictTriggerTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="0"
                                 ToolTip="Trigger word"/>
                        <TextBox x:Name="DictReplacementTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="2"
                                 ToolTip="Replacement"/>
                        <Button Content="+"
                                Style="{StaticResource PrimaryButton}"
                                Grid.Column="3"
                                Margin="8,0,0,0"
                                Width="40"
                                Click="AddDictEntry_Click"/>
                    </Grid>

                    <ItemsControl x:Name="DictionaryList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource SurfaceBrush}"
                                        Padding="12,8"
                                        Margin="0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox IsChecked="{Binding IsEnabled}"
                                                  Grid.Column="0"
                                                  VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="1" Margin="8,0">
                                            <TextBlock Text="{Binding Trigger}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Replacement, StringFormat='â†’ {0}'}"
                                                       Style="{StaticResource CaptionText}"/>
                                        </StackPanel>
                                        <Button Content="ðŸ—‘"
                                                Style="{StaticResource IconButton}"
                                                Grid.Column="2"
                                                Tag="{Binding}"
                                                Click="DeleteDictEntry_Click"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Context Rules Settings -->
                <StackPanel x:Name="RulesPanel" Visibility="Collapsed">
                    <TextBlock Text="Context Rules" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Add rules to customize transcription output (e.g., 'Format numbers as digits', 'Use formal language')"
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="NewRuleTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="0"
                                 ToolTip="Enter a new rule..."/>
                        <Button Content="+"
                                Style="{StaticResource PrimaryButton}"
                                Grid.Column="1"
                                Margin="8,0,0,0"
                                Width="40"
                                Click="AddRule_Click"/>
                    </Grid>

                    <ItemsControl x:Name="RulesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource SurfaceBrush}"
                                        Padding="12,8"
                                        Margin="0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox IsChecked="{Binding IsEnabled}"
                                                  Grid.Column="0"
                                                  VerticalAlignment="Center"
                                                  Checked="RuleToggle_Changed"
                                                  Unchecked="RuleToggle_Changed"/>
                                        <TextBlock Text="{Binding Text}"
                                                   Grid.Column="1"
                                                   VerticalAlignment="Center"
                                                   Margin="8,0"/>
                                        <Button Content="ðŸ—‘"
                                                Style="{StaticResource IconButton}"
                                                Grid.Column="2"
                                                Tag="{Binding}"
                                                Click="DeleteRule_Click"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <!-- Shortcuts Settings -->
                <StackPanel x:Name="ShortcutsPanel" Visibility="Collapsed">
                    <TextBlock Text="Shortcuts" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Shortcuts let you say a phrase and have it expand to longer text (e.g., 'my email' â†’ 'hello@example.com')"
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="ShortcutTriggerTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="0"
                                 ToolTip="Voice trigger"/>
                        <TextBox x:Name="ShortcutExpansionTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="2"
                                 ToolTip="Expansion text"/>
                        <Button Content="+"
                                Style="{StaticResource PrimaryButton}"
                                Grid.Column="3"
                                Margin="8,0,0,0"
                                Width="40"
                                Click="AddShortcut_Click"/>
                    </Grid>

                    <ItemsControl x:Name="ShortcutsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource SurfaceBrush}"
                                        Padding="12,8"
                                        Margin="0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox IsChecked="{Binding IsEnabled}"
                                                  Grid.Column="0"
                                                  VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="1" Margin="8,0">
                                            <TextBlock Text="{Binding VoiceTrigger}" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Expansion, StringFormat='â†’ {0}'}"
                                                       Style="{StaticResource CaptionText}"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                        <Button Content="ðŸ—‘"
                                                Style="{StaticResource IconButton}"
                                                Grid.Column="2"
                                                Tag="{Binding}"
                                                Click="DeleteShortcut_Click"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>
