<Window x:Class="AIDictation.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings"
        Width="700" Height="550"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        MinWidth="600" MinHeight="450"
        Background="{StaticResource BackgroundBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}">
            <StackPanel Margin="8,16">
                <RadioButton x:Name="GeneralTab"
                             Content="âš™ï¸ General"
                             IsChecked="True"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="AccountTab"
                             Content="ðŸ‘¤ Account"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="PermissionsTab"
                             Content="ðŸ”’ Permissions"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="AudioTab"
                             Content="ðŸ”Š Audio"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="LanguageTab"
                             Content="ðŸŒ Language"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
                <RadioButton x:Name="RulesTab"
                             Content="ðŸ“ Context Rules"
                             GroupName="SettingsTabs"
                             Margin="0,4"
                             Padding="12,8"
                             Checked="Tab_Checked"/>
            </StackPanel>
        </Border>

        <!-- Content Area -->
        <ScrollViewer Grid.Column="1" Padding="24">
            <Grid>
                <!-- General Settings -->
                <StackPanel x:Name="GeneralPanel">
                    <TextBlock Text="General" Style="{StaticResource HeadlineText}"/>

                    <!-- Recording Hotkey -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Recording Hotkey" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Press this key combination to toggle recording from anywhere"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Border Grid.Column="1"
                                    Background="{StaticResource SurfaceBrush}"
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="6"
                                    Padding="16,8"
                                    MinWidth="150"
                                    Cursor="Hand"
                                    MouseLeftButtonDown="HotkeyBox_Click">
                                <TextBlock x:Name="CurrentHotkeyDisplay"
                                           Text="Click to set..."
                                           HorizontalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Launch at Startup -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Launch at Startup" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically start AIDictation when you log in"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="LaunchAtStartupCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="LaunchAtStartup_Changed" Unchecked="LaunchAtStartup_Changed"/>
                        </Grid>
                    </Border>

                    <!-- Auto Paste -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Auto Paste After Transcription" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically paste transcribed text into the active window"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="AutoPasteCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="AutoPaste_Changed" Unchecked="AutoPaste_Changed"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Account Settings -->
                <StackPanel x:Name="AccountPanel" Visibility="Collapsed">
                    <TextBlock Text="Account" Style="{StaticResource HeadlineText}"/>

                    <!-- API Key -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <StackPanel>
                            <TextBlock Text="OpenAI API Key" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                            <TextBlock Text="Your API key is stored securely on your device"
                                       Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            <PasswordBox x:Name="ApiKeyPasswordBox"
                                         Margin="0,12,0,0"
                                         Padding="12,10"
                                         FontSize="14"/>
                            <Button Content="Save API Key"
                                    Style="{StaticResource PrimaryButton}"
                                    HorizontalAlignment="Left"
                                    Margin="0,12,0,0"
                                    Click="SaveApiKey_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- Reset Application -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Reset Application" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Clear all data and restart onboarding"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <Button Content="Reset"
                                    Style="{StaticResource SecondaryButton}"
                                    Grid.Column="1"
                                    Click="ResetApp_Click"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Permissions Settings -->
                <StackPanel x:Name="PermissionsPanel" Visibility="Collapsed">
                    <TextBlock Text="Permissions" Style="{StaticResource HeadlineText}"/>

                    <!-- Microphone -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ðŸŽ™ï¸" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Microphone" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Required to record audio for transcription"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Orientation="Horizontal">
                                <TextBlock x:Name="MicPermissionStatus" Text="âœ“" Foreground="{StaticResource SuccessBrush}"
                                           FontSize="18" VerticalAlignment="Center"/>
                                <Button x:Name="MicPermissionButton" Content="Grant Access"
                                        Style="{StaticResource SecondaryButton}"
                                        Visibility="Collapsed"
                                        Click="OpenMicrophoneSettings_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <TextBlock Text="Windows automatically manages microphone permissions. If you experience issues, check Windows Privacy Settings."
                               Style="{StaticResource CaptionText}"
                               TextWrapping="Wrap"
                               Margin="0,12,0,0"/>
                </StackPanel>

                <!-- Audio Settings -->
                <StackPanel x:Name="AudioPanel" Visibility="Collapsed">
                    <TextBlock Text="Audio" Style="{StaticResource HeadlineText}"/>

                    <!-- Input Device -->
                    <Border Style="{StaticResource Card}" Margin="0,16,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Input Device" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Select your microphone or audio input device"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <ComboBox x:Name="AudioDeviceCombo"
                                      Grid.Column="1"
                                      Width="250"
                                      SelectionChanged="AudioDevice_SelectionChanged"/>
                        </Grid>
                    </Border>

                    <!-- Mute Other Audio -->
                    <Border Style="{StaticResource Card}" Margin="0,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Mute Other Audio When Recording" Style="{StaticResource BodyText}" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatically lower system volume while recording"
                                           Style="{StaticResource CaptionText}" Margin="0,4,0,0"/>
                            </StackPanel>
                            <CheckBox x:Name="MuteAudioCheck" Grid.Column="1" VerticalAlignment="Center"
                                      Checked="MuteAudio_Changed" Unchecked="MuteAudio_Changed"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Language Settings -->
                <StackPanel x:Name="LanguagePanel" Visibility="Collapsed">
                    <TextBlock Text="Language" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Select language for transcription. Auto-detect works for all languages."
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <WrapPanel>
                        <RadioButton x:Name="LangAuto" Content="ðŸŒ Auto" GroupName="Language" IsChecked="True" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangEn" Content="ðŸ‡ºðŸ‡¸ English" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangRu" Content="ðŸ‡·ðŸ‡º Russian" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangDe" Content="ðŸ‡©ðŸ‡ª German" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangFr" Content="ðŸ‡«ðŸ‡· French" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangEs" Content="ðŸ‡ªðŸ‡¸ Spanish" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangIt" Content="ðŸ‡®ðŸ‡¹ Italian" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangPt" Content="ðŸ‡µðŸ‡¹ Portuguese" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangZh" Content="ðŸ‡¨ðŸ‡³ Chinese" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangJa" Content="ðŸ‡¯ðŸ‡µ Japanese" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                        <RadioButton x:Name="LangKo" Content="ðŸ‡°ðŸ‡· Korean" GroupName="Language" Margin="0,4,16,4" Checked="Language_Checked"/>
                    </WrapPanel>
                </StackPanel>

                <!-- Context Rules Settings -->
                <StackPanel x:Name="RulesPanel" Visibility="Collapsed">
                    <TextBlock Text="Context Rules" Style="{StaticResource HeadlineText}"/>
                    <TextBlock Text="Add rules to customize transcription output (e.g., 'Format numbers as digits', 'Use formal language')"
                               Style="{StaticResource CaptionText}" Margin="0,4,0,16"/>

                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="NewRuleTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Grid.Column="0"
                                 ToolTip="Enter a new rule..."/>
                        <Button Content="+"
                                Style="{StaticResource PrimaryButton}"
                                Grid.Column="1"
                                Margin="8,0,0,0"
                                Width="40"
                                Click="AddRule_Click"/>
                    </Grid>

                    <ItemsControl x:Name="RulesList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource SurfaceBrush}"
                                        CornerRadius="6"
                                        Padding="12,8"
                                        Margin="0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <CheckBox IsChecked="{Binding IsEnabled}"
                                                  Grid.Column="0"
                                                  VerticalAlignment="Center"
                                                  Checked="RuleToggle_Changed"
                                                  Unchecked="RuleToggle_Changed"/>
                                        <TextBlock Text="{Binding Text}"
                                                   Grid.Column="1"
                                                   VerticalAlignment="Center"
                                                   Margin="8,0"/>
                                        <Button Content="ðŸ—‘"
                                                Style="{StaticResource IconButton}"
                                                Grid.Column="2"
                                                Tag="{Binding}"
                                                Click="DeleteRule_Click"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Window>
